{"requestURL":"https://t24mobile.com/scripts/controllers/recharges/mobile/mobileVerifyPayCtrlShop.js","requestMethod":"GET","requestHeaders":{"Referer":"https://t24mobile.com/","User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.76 Safari/537.36"},"responseURL":"https://t24mobile.com/scripts/controllers/recharges/mobile/mobileVerifyPayCtrlShop.js","responseStatus":200,"responseStatusText":"OK","responseProtocol":"http/1.1","responseBody":"t24App.controller('mobileVerifyPayCtrlShop', ['$scope', '$cookieStore', 'appService', 'authService','$log', '$stateParams', '$state', '$window', function($scope, $cookieStore, appService, authService,$log, $stateParams, $state, $window) {\r\n\r\n\r\n    $scope.mobileNo = $stateParams.mobileNo;\r\n    $scope.amount = $stateParams.amount;\r\n    $scope.coupons = $stateParams.promoCode;\r\n\r\n\r\n    var mobileNo = $cookieStore.get('globals').currentUser.registeredID;\r\n    var customToken = $cookieStore.get('globals').currentUser.customToken;\r\n    $scope.loggedIn = $cookieStore.get('userloggedIn');\r\n    var s =  $cookieStore.get('invisible');\r\n    $scope.invisible = s;\r\n\r\n    var apptoken = $cookieStore.get('globals').currentUser.appToken;\r\n    $log.log('apptoken-->', apptoken);\r\n    $scope.loadGetAllList = function() {\r\n        appService.getPromoList(apptoken, \"\", function(response) {\r\n            console.log(response);\r\n\r\n            if (response.msgDesc == \"Success\") {\r\n                angular.forEach(response.data, function(value, key) {\r\n                    // console.log(value);\r\n                    if (value.promoCode == $scope.coupons) {\r\n                        $scope.promoListImg = value.promoImage;\r\n                        $scope.promoHeader1 = value.promoHeader1;\r\n                        console.log($scope.promoListImg);\r\n                    }\r\n                });\r\n            } else if (response.isSuccessful == false && response.msgDesc == 'Token is Not Valid') {\r\n                //$log.log(response.msgDesc);\r\n                if ($scope.loggedIn == 1) {\r\n                    $scope.invisible = !s; //!authService.invisible;\r\n                    $cookieStore.put('invisible', !s);\r\n                    $cookieStore.put('userloggedIn', 0);\r\n                    authService.clearCredentials();\r\n                    $window.alert('Session Expired ! Please login again.');\r\n                    $state.go('home');\r\n\r\n                } else {\r\n                    $window.alert('Session Expired ! Click OK to start session again');\r\n                    $state.go('home');\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    $scope.loadGetAllList();\r\n    var firstName = \"\";\r\n    var email = \"\";\r\n    var custToken = \"\";\r\n    var appConfigMob = \"\";\r\n    var accRegMobile = \"\";\r\n    appService.getProfile(mobileNo, apptoken, function(response) {\r\n        $log.log(response);\r\n        firstName = response.data.firstName;\r\n        email = response.data.email;\r\n        custToken = response.data.custToken;\r\n        appConfigMob = response.data.contactNo; // registered mobile number\r\n\r\n    });\r\n    var phone = $stateParams.mobileNo;\r\n    var productInfo = \"rechared-\" + $stateParams.mobileNo; //+n.mobileNo;\r\n    var udf1 = \"T24\"; // here he is sending OXI \r\n    var udf2 = $stateParams.mobileNo;\r\n    var udf3 = \"OPR000\";\r\n    var udf4 = $stateParams.operator;\r\n    var udf5 = $scope.coupons;\r\n    var circleID = $stateParams.circle;;\r\n    //var accRegMobile = appConfigMob;\r\n    var rechargeType = \"MOBILE\";\r\n    //var amount = 10.20;\r\n    accRegMobile = $stateParams.mobileNo;\r\n\r\n\r\n    /*\r\n      var custToken = \"E5303E3631BCC91B2CE2C42FD1269D0D8B9C14268D4AA7051D9E0162D524D7D090C1EC5E453618EA\";\r\n      var appConfigMob = \"9727743579\";\r\n      var phone = \"9727743579\";\r\n      var productInfo = \"rechared-9727743579\";//+n.mobileNo;\r\n      var firstName = \"Sharad\";\r\n      var email = \"rajputsharad@gmail.com\";\r\n      var udf1 = \"OXI\";\r\n      var udf2 = \"9727743579\";\r\n      var udf3 = \"OPR000\";\r\n      var udf4 =  \"TOPUP\";\r\n      var udf5 = \"HO00001070\";\r\n      var circleID = \"CIR001\";\r\n      var accRegMobile = \"9727743579\";\r\n      var rechargeType = \"MOBILE\";\r\n      var amount = 10.20;*/\r\n\r\n\r\n    $scope.mobilePayementProceed = function() {\r\n        console.log(custToken, appConfigMob, $scope.amount, productInfo, firstName, email, udf1, udf2, udf3, udf4, udf5, circleID, accRegMobile, rechargeType);\r\n        appService.payUHashCreation(custToken, appConfigMob, $scope.amount, productInfo, firstName, email, udf1, udf2, udf3, udf4, udf5, circleID, accRegMobile, rechargeType, function(response) {\r\n            console.log(response);\r\n            if (response.msgDesc == \"Success\" && response.isSuccessful == true) {\r\n                localStorage.setItem(\"txnNo\", response.data.txnNo);\r\n                localStorage.setItem(\"amount\", $scope.amount);\r\n                var payUObj = {\r\n                    'key': response.data.key,\r\n                    'hash': response.data.paymentHash,\r\n                    'vasHash': response.data.vasHash,\r\n                    'merchantIbiboCodesHash': response.data.merchantIbiboCodesHash,\r\n                    'saveUserCardHash': response.data.saveUserCardHash,\r\n                    'deleteCardHash': response.data.deleteCardHash,\r\n                    'getUserCardHash': response.data.getUserCardHash,\r\n                    'editUserCardHash': response.data.editUserCardHash,\r\n                    'paymentRelatedMobileHash': response.data.paymentRelatedMobileHash,\r\n                    'txnid': response.data.txnNo,\r\n                    'amount': $scope.amount,\r\n                    'firstname': firstName,\r\n                    'email': email,\r\n                    'phone': phone,\r\n                    'productinfo': productInfo,\r\n                    'surl': 'https://t24mobile.com/successredirect.aspx', //'https://t24mobile.com/#/mobileThankU',\r\n                    'furl': 'https://t24mobile.com/failureredirect.aspx',\r\n                    'udf1': udf1,\r\n                    'udf2': udf2,\r\n                    'udf3': udf3,\r\n                    'udf4': udf4,\r\n                    'udf5': udf5,\r\n                }\r\n\r\n                console.log(payUObj);\r\n                appService.payUDataFinal = payUObj;\r\n                $state.go('payU');\r\n                //$uibModalInstance.dismiss('cancel');\r\n            } else if (response.isSuccessful == false && response.msgDesc == 'Token is Not Valid') {\r\n                //$log.log(response.msgDesc);\r\n                if ($scope.loggedIn == 1) {\r\n                    $scope.invisible = !s; //!authService.invisible;\r\n                    $cookieStore.put('invisible', !s);\r\n                    $cookieStore.put('userloggedIn', 0);\r\n                    authService.clearCredentials();\r\n                    $window.alert('Session Expired ! Please login again.');\r\n                    $state.go('home');\r\n\r\n                } else {\r\n                    $window.alert('Session Expired ! Click OK to start session again');\r\n                    $state.go('home');\r\n                }\r\n            }\r\n\r\n            //To check the transaction status\r\n            // var registeredId = \"9727743579\";\r\n            // appService.payUTxnStatusCheck(custToken,registeredId,response.data.txnNo,function(res){\r\n\r\n            //   $sessionStorage.payUTxnStatusCheckValue = res;\r\n            //   console.log(res);\r\n            //   console.log($sessionStorage.payUTxnStatusCheckValue);\r\n            // }); \r\n        });\r\n    };\r\n\r\n\r\n}]);\r\n","responseBase64":false,"responseHeaders":{"Date":"Fri, 26 May 2017 20:00:29 GMT","Content-Encoding":"gzip","ETag":"\"dc988cadc8cd21:0\"","Last-Modified":"Wed, 22 Feb 2017 07:19:44 GMT","Server":"Microsoft-IIS/7.5","X-Powered-By":"ASP.NET","Vary":"Accept-Encoding","Content-Type":"application/x-javascript","Access-Control-Allow-Origin":"*","Accept-Ranges":"bytes","Content-Length":"2131"}}