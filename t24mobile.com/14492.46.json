{"requestURL":"https://t24mobile.com/scripts/controllers/storeLocatorCtrl.js","requestMethod":"GET","requestHeaders":{"Referer":"https://t24mobile.com/","User-Agent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.76 Safari/537.36"},"responseURL":"https://t24mobile.com/scripts/controllers/storeLocatorCtrl.js","responseStatus":200,"responseStatusText":"OK","responseProtocol":"http/1.1","responseBody":"t24App.controller('storeLocatorCtrl', ['$scope', '$log', '$window', '$state', '$cookieStore', '$geolocation', 'NgMap', 'appService', 'authService', function($scope, $log, $window, $state, $cookieStore, $geolocation, NgMap, appService, authService) {\r\n\r\n    var appToken = $cookieStore.get('appToken');\r\n    var map;\r\n    $scope.checkbox = [];\r\n    $scope.loggedIn = $cookieStore.get('userloggedIn');\r\n    var s = $cookieStore.get('invisible');\r\n    $scope.invisible = s;\r\n\r\n    NgMap.getMap().then(function(evtMap) {\r\n        map = evtMap;\r\n    });\r\n    $scope.$on('mapInitialized', function(event, map) {\r\n        $scope.objMapa = map;\r\n    });\r\n    /*\r\n    $scope.states = [\r\n        'Andhra Pradesh',\r\n        'Arunachal Pradesh',\r\n        'Assam',\r\n        'Bihar',\r\n        'Chattisgarh',\r\n        'Delhi',\r\n        'Goa',\r\n        'Gujarat',\r\n        'Haryana',\r\n        'Himachal Pradesh',\r\n        'Jharkhand',\r\n        'Jammu And Kashmir',\r\n        'Karnataka',\r\n        'Kerala',\r\n        'Madhya Pradesh',\r\n        'Maharastra',\r\n        'Odisha',\r\n        'Punjab',\r\n        'Rajasthan',\r\n        'Sikkim',\r\n        'Tamil Nadu',\r\n        'Telangana',\r\n        'Tripura',\r\n        'Uttarakhand',\r\n        'Uttar Pradesh',\r\n        'West Bengal'\r\n    ];*/\r\n\r\n    $scope.states = [];\r\n    appService.getCities(appToken, '', function(response) {\r\n        if (response.isSuccessful == true) {\r\n            $scope.res = response.data;\r\n            angular.forEach($scope.res, function(val, key) {\r\n                $scope.states.push(val.stateName);\r\n            });\r\n        } else if (response.isSuccessful == false && response.msgDesc == 'Token is Not Valid') {\r\n            //$log.log(response.msgDesc);\r\n            if ($scope.loggedIn == 1) {\r\n                $scope.invisible = !s;\r\n                $cookieStore.put('invisible', !s);\r\n                $cookieStore.put('userloggedIn', 0);\r\n                authService.clearCredentials();\r\n                $window.alert('Session Expired ! Please login again.');\r\n                $state.go('home');\r\n\r\n            } else {\r\n                $window.alert('Session Expired ! Click OK to start session again');\r\n                $state.go('home');\r\n            }\r\n        } else {\r\n            $scope.states = 'No Records Found!'\r\n        }\r\n    });\r\n\r\n    $scope.sc = \"-- Select City --\";\r\n    $scope.getAllCities = function(state) {\r\n        $scope.cities = [];\r\n        $scope.loader = true;\r\n        appService.getCities(appToken, state, function(response) {\r\n            $scope.getAllStores(state, ' ');\r\n            if (response.isSuccessful == true) {\r\n                $scope.sc = \"-- Select City --\";\r\n                $scope.res = response.data;\r\n                $scope.cityList = $scope.res[0].cityList;\r\n                $log.log('City length-------->', $scope.cityList.length);\r\n\r\n                if ($scope.cityList.length != '0') {\r\n                    angular.forEach($scope.cityList, function(value, key) {\r\n                        $scope.cities.push({ id: value.cityId, name: value.cityName });\r\n                    });\r\n                }else{\r\n                    $scope.sc = 'No Records Found!'\r\n                }\r\n\r\n            } else if (response.isSuccessful == false && response.msgDesc == 'Token is Not Valid') {\r\n                //$log.log(response.msgDesc);\r\n                if ($scope.loggedIn == 1) {\r\n                    $scope.invisible = !s; //!authService.invisible;\r\n                    $cookieStore.put('invisible', !s);\r\n                    $cookieStore.put('userloggedIn', 0);\r\n                    authService.clearCredentials();\r\n                    $window.alert('Session Expired ! Please login again.');\r\n                    $state.go('home');\r\n\r\n                } else {\r\n                    $window.alert('Session Expired ! Click OK to start session again');\r\n                    $state.go('home');\r\n                }\r\n            } else {\r\n                //$scope.sc = response.msgDesc;\r\n                $scope.sc = 'No Records Found!'\r\n            }\r\n        });\r\n    };\r\n\r\n    $scope.getCurrentLocation = function() {\r\n        $scope.loader = true;\r\n        $geolocation.getCurrentPosition({\r\n            timeout: 60000\r\n        }).then(function(position) {\r\n            $scope.myPosition = position;\r\n\r\n            var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);\r\n            var geocoder = new google.maps.Geocoder();\r\n\r\n            var city, statepin, state;\r\n\r\n            geocoder.geocode({ 'latLng': latlng }, function(results, status) {\r\n                if (status == google.maps.GeocoderStatus.OK) {\r\n                    if (results[0]) {\r\n                        var add = results[0].formatted_address;\r\n                        var value = add.split(\",\");\r\n\r\n                        count = value.length;\r\n                        country = value[count - 1];\r\n                        statepin = value[count - 2].trim();\r\n                        state = statepin.substr(0, statepin.indexOf(' '));\r\n                        city = value[count - 3].trim();\r\n\r\n                        $log.log(state, city);\r\n                        $scope.state = state;\r\n                        $scope.getAllCities($scope.state);\r\n                        $scope.city = city;\r\n                        $scope.getAllStores(state, city);\r\n                    } else {\r\n                        $log.log(\"address not found\");\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    Array.prototype.contains = function(v) {\r\n        for (var i = 0; i < this.length; i++) {\r\n            if (this[i] === v) return true;\r\n        }\r\n        return false;\r\n    };\r\n\r\n    Array.prototype.unique = function() {\r\n        var arr = [];\r\n        for (var i = 0; i < this.length; i++) {\r\n            if (!arr.contains(this[i])) {\r\n                arr.push(this[i]);\r\n            }\r\n        }\r\n        return arr;\r\n    };\r\n\r\n    $scope.loader = false;\r\n    $scope.allStores = 0;\r\n    $scope.t24Stores = 0;\r\n    $scope.getAllStores = function(state, city) {\r\n        $log.log(appToken, state, city);\r\n        var map = document.getElementsByClassName('map')[0];\r\n        $scope.markerData = [];\r\n        $scope.allFormatCode = [];\r\n        $scope.fc = '';\r\n        $scope.loader = true;\r\n        appService.getStores(appToken, '', state.trim(), city.trim(), function(response) {\r\n            $scope.loader = false;\r\n            if (response.isSuccessful == true) {\r\n                $scope.res = response.data;\r\n                $scope.allData = [];\r\n\r\n                if (state == '' && city == '')\r\n                    $scope.allStores = $scope.res.length;\r\n\r\n\r\n                if ($scope.res != '') {\r\n                    $scope.errMsg = '';\r\n                    angular.forEach($scope.res, function(value, key) {\r\n                        /*$scope.customIcon = {\r\n                            \"scaledSize\": [20, 30],\r\n                            \"url\": \"images/t24\" + value.t24 + \".png\"\r\n                        };*/\r\n                        if (value.latitude != null && value.longitude != null) {\r\n                            $scope.allData.push(value);\r\n                            //$scope.allStores = $scope.allData.length;\r\n\r\n                            /****** count T24 stores ******/\r\n                            if (value.t24 == true) {\r\n\r\n                                if (state == '' && city == '')\r\n                                    $scope.t24Stores = $scope.t24Stores + 1;\r\n\r\n                                //$scope.t24Storeslen = $scope.t24Stores;\r\n                            }\r\n\r\n                            if (state != '') {\r\n                                $scope.markerData.push({\r\n                                    \"id\": key + 1,\r\n                                    \"latitude\": value.latitude,\r\n                                    \"longitude\": value.longitude,\r\n                                    \"title\": value.address,\r\n                                    \"storeName\": value.storeName,\r\n                                    \"formatCode\": value.formatCode,\r\n                                    \"t24\": value.t24,\r\n                                    \"icon\": {\r\n                                        \"scaledSize\": [22, 35],\r\n                                        \"url\": \"images/map/\" + value.formatCode + \".png\"\r\n                                    }\r\n                                });\r\n\r\n                                $scope.allFormatCode.push(value.formatCode);\r\n\r\n                                $scope.formatCode = $scope.allFormatCode.unique();\r\n                            } else {\r\n                                $scope.markerData = [];\r\n                                $scope.formatCode = '';\r\n                                $scope.t24Storeslen = 0;\r\n                            }\r\n\r\n                        }\r\n                    });\r\n                    //$log.log('all data without null value-->',JSON.stringify($scope.allData));\r\n                    $scope.fc = $scope.formatCode;\r\n                    //$log.log('fc ------->', $scope.fc);\r\n\r\n                    $scope.isMatch = function(fc) {\r\n                        return $scope.fc.indexOf(fc) >= 0;\r\n                    };\r\n\r\n                } else {\r\n                    $scope.errMsg = 'No Stores Found';\r\n                }\r\n\r\n            } else if (response.isSuccessful == false) {\r\n                //$log.log(response.msgDesc);\r\n                /*if ($scope.loggedIn == 1) {\r\n                    $scope.invisible = !s; //!authService.invisible;\r\n                    $cookieStore.put('invisible', !s);\r\n                    $cookieStore.put('userloggedIn', 0);\r\n                    authService.clearCredentials();\r\n                    $window.alert('Session Expired ! Please login again.');\r\n                    $state.go('home');\r\n\r\n                } else {\r\n                    $window.alert('Session Expired ! Click OK to start session again');\r\n                    $state.go('home');\r\n                }*/\r\n\r\n\r\n            }\r\n        });\r\n    };\r\n    $scope.getAllStores('', '');\r\n\r\n\r\n    $scope.isChanged = function(index, event) {\r\n        //$log.log(\"checkbox \" + index + \" is \" + $scope.checkbox[index]);\r\n\r\n        if ($scope.checkbox[index] != true) {\r\n            if (index == 'T24') {\r\n                for (var i = $scope.markerData.length - 1; i >= 0; i--) {\r\n                    if ($scope.markerData[i].t24 == true) {\r\n                        $scope.markerData.splice(i, 1);\r\n                    }\r\n                }\r\n            } else {\r\n                for (var i = $scope.markerData.length - 1; i >= 0; i--) {\r\n                    if ($scope.markerData[i].formatCode == index) {\r\n                        $scope.markerData.splice(i, 1);\r\n                    }\r\n                }\r\n            }\r\n        } else if ($scope.checkbox[index] == true) {\r\n            if (index == 'T24') {\r\n                angular.forEach($scope.allData, function(value, key) {\r\n                    if ($scope.checkbox[index] == value.t24) {\r\n                        $scope.markerData.push({\r\n                            \"id\": key + 1,\r\n                            \"latitude\": value.latitude,\r\n                            \"longitude\": value.longitude,\r\n                            \"title\": value.address,\r\n                            \"storeName\": value.storeName,\r\n                            \"formatCode\": value.formatCode,\r\n                            \"t24\": value.t24,\r\n                            \"icon\": {\r\n                                \"scaledSize\": [22, 35],\r\n                                \"url\": \"images/map/\" + value.formatCode + \".png\"\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n            } else {\r\n                angular.forEach($scope.allData, function(value, key) {\r\n                    if (index == value.formatCode) {\r\n                        $scope.markerData.push({\r\n                            \"id\": key + 1,\r\n                            \"latitude\": value.latitude,\r\n                            \"longitude\": value.longitude,\r\n                            \"title\": value.address,\r\n                            \"storeName\": value.storeName,\r\n                            \"formatCode\": value.formatCode,\r\n                            \"t24\": value.t24,\r\n                            \"icon\": {\r\n                                \"scaledSize\": [22, 35],\r\n                                \"url\": \"images/map/\" + value.formatCode + \".png\"\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    var activeWindow;\r\n    $scope.showInfoWindow = function(event, p) {\r\n        var infowindow = new google.maps.InfoWindow();\r\n        var center = new google.maps.LatLng(p.latitude, p.longitude);\r\n\r\n        $scope.t24Avail;\r\n        if (p.t24 == true) {\r\n            $scope.t24Avail = 'Yes';\r\n        } else {\r\n            $scope.t24Avail = 'No';\r\n        }\r\n\r\n        if (activeWindow != null)\r\n            activeWindow.close();\r\n\r\n        infowindow.setContent(\r\n            '<span><b>' + p.storeName + '</b><br>' +\r\n            '<br><span style=\"font-size:12px\"><b>Address : </b></span>' + p.title + '</span><br>' +\r\n            '<br><span style=\"font-size:12px\"><b>T24 Available : </b></span>' + $scope.t24Avail + '</span><br><br>' +\r\n            '<a style=\"text-decoration:underline; font-size:11px\" target=\"_blank\" href=\"https://www.google.com/maps/place/+' + p.latitude + ',' + p.longitude + '/@' + p.latitude + ',' + p.longitude + ',66m/data=!3m1!1e3\">View on Google Map</a>'\r\n        );\r\n        //'<span><b>' + p.latitude + '</b><br>' + p.longitude + '</span>');\r\n\r\n        infowindow.setPosition(center);\r\n        infowindow.open($scope.objMapa);\r\n        activeWindow = infowindow;\r\n    };\r\n\r\n}]);\r\n\r\n//Google maps api key---->AIzaSyAjhYaf87SkXSIOk4IFM8kNVVcgageuLts\r\n","responseBase64":false,"responseHeaders":{"Date":"Fri, 26 May 2017 20:00:29 GMT","Content-Encoding":"gzip","ETag":"\"30e5b83df90d21:0\"","Last-Modified":"Mon, 27 Feb 2017 09:51:06 GMT","Server":"Microsoft-IIS/7.5","X-Powered-By":"ASP.NET","Vary":"Accept-Encoding","Content-Type":"application/x-javascript","Access-Control-Allow-Origin":"*","Accept-Ranges":"bytes","Content-Length":"3719"}}